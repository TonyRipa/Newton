
<!--
	Author: Anthony John Ripa
	Date:	4/10/2023
	Demo for Newton: An A.I. for Math
-->

<!DOCTYPE html>
<html>
	<head>
		<title>Newton</title>
		<meta charset="utf-8" />
		<script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.17.0/plotly.js"></script>	<!--	+2023.1	-->
		<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.7.0/d3.min.js"></script>-->	<!--	+2022.12-->	<!--	-2023.1	-->
		<script src='../js/jquery.js'></script><script>window.jQuery || document.write("<script src='https://code.jquery.com/jquery-latest.js'><" + "/script>")</script>
		<!-- <script src='../js/math3.js'></script><script>window.math || document.write("<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.18.0/math.min.js'><" + "/script>")</script> -->	<!--	-2023.4	-->
		<script src='../js/math4.4.1.js'></script><script>window.math || document.write("<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjs/4.4.1/math.min.js'><" + "/script>")</script>	<!--	+2023.4	-->
		<script src='../js/lodash.js'></script><script>window._ || document.write("<script src='https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.10/lodash.min.js'><" + "/script>")</script>
		<script src='../js/jsxgraphcore.js'></script>
		<script>
			window.JXG || document.write("<script src='https://cdnjs.cloudflare.com/ajax/libs/jsxgraph/0.99.6/jsxgraphcore.js'><" + "/script>");
			window.JXG || document.write("<link rel='stylesheet' type='text/css' href='https://jsxgraph.uni-bayreuth.de/distrib/jsxgraph.css' />");
		</script>
		<script src='../js/vis.js'></script><script>window.vis || document.write("<script src='https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js'><" + "/script>")</script>
		<link rel="stylesheet" type="text/css" href="../css/jsxgraph.css" />
		<script src="transform.js"></script>
		<script src="render.js"></script>		<!--	2020.7	Added	-->
		<script src="untransform.js"></script>	<!--	2020.2	Added	-->
		<script src="matrix.js"></script>		<!--	2018.9	Added	-->
		<script src="fit.js"></script>			<!--	2019.8	Added	-->
		<script src="expression.js"></script>	<!--	+2021.9			-->
		<script src="newton.js"></script>
		<script src="plot.js"></script>
		<script src='../js/vue.js'></script><script>window.Vue || document.write("<script src='https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.8/vue.min.js'><" + "/script>")</script>	<!--	2019.6	Added	-->
		<script>
			function go() {
				if ($('details')[0].open) go1();
				else cascade();
			}
			function go1() {																	//	+2019.12	//	2020.11 Renamed
				//[vm.pointss, vm.exprsimp, vm.totalsimp, vm.e, vm.untransformed] = simplify();					//	+2020.10	//	-2021.11
				//[vm.selected, vm.e, vm.pointss, vm.exprsimp, vm.untransformed, vm.totalsimp] = simplify();					//	+2021.11	//	-2022.11
				vm.simplify = simplify();																										//	+2022.11
				[vm.selected, vm.e, vm.pointss, vm.exprsimp, vm.untransformed] = vm.simplify;													//	+2022.11
			}
			function cascade() {			//	+2020.11
				for (vm.range=1; vm.range<=9; vm.range++) {		//	+2020.12
					for (vm.trans of [0,1]) {	//	+2021.1
						//[vm.pointss, vm.exprsimp, vm.totalsimp, vm.e, vm.untransformed] = simplify();				//	-2021.11
						//[vm.selected, vm.e, vm.pointss, vm.exprsimp, vm.untransformed, vm.totalsimp] = simplify();//	+2021.11			//	-2022.11
						vm.simplify = simplify();																							//	+2022.11
						[vm.selected, vm.e, vm.pointss, vm.exprsimp, vm.untransformed] = vm.simplify;										//	+2022.11
						//if (vm.e && vm.e[vm.selected]<.00001) break;	//	-2021.1
						if (vm.e && vm.e[vm.selected]<.00001) return;	//	+2021.1
					}
				}
			}
			function simplify() {	//	2019.12	Added
				var input;
				input = $('#inp').val() || '0';
				//vm.d = math.max(Newton.getvars(input).length,1) + 1;														//	2018.12	//	-2021.9
				vm.d = math.max(Expression.getvars(input).length,1) + 1;																//	+2021.9
				if (vm.d==3 && vm.trans!=0) { alert('Error : Attempting to transform a 3D graph.') ; return }				//	2018.12
				vm.expr = input.split('|')[0];
				vm.constant = input.split('|')[1];
				//if (vm.constant && vm.trans!=0) { alert('Error : Attempting to transform a point evaluation.') ; return }	//	2019.3	//	-2021.1
				return Newton.simplify(input);										//	2019.12	Added
			}
			function render() {
				render_panes(make_panes());
				function make_panes() {
					var panes = [];
					var exprsimp = vm.exprsimp[vm.selected];
					//var totalsimp = (vm.totalsimp||vm.exprsimp)[vm.selected];	//	-2022.11
					var totalsimp = (vm.simplify.slice(-1)[0])[vm.selected];	//	+2022.11
					panes.push(vm.expr);
					if (vm.d == 2) panes.push([vm.pointss.orig, vm.expr]); else panes.push([vm.pointss.nonan, vm.expr]);
					panes.push(exprsimp);
					panes.push(vm.exprsimp);
					//if (vm.trans>0) panes.push(vm.untransformed[vm.selected]);								//	-2022.05
					if (vm.trans>0) vm.untransformed[vm.selected].map(untranselem => panes.push(untranselem));	//	+2022.05
					if (vm.constant) if (vm.d == 2) panes.push([vm.trans==0?exprsimp:vm.untransformed[vm.selected], vm.constant, totalsimp]); else panes.push([exprsimp, vm.constant, totalsimp]);
					if (vm.constant) panes.push(totalsimp);
					return panes;
				}
				function render_panes(panes) {
					plot_clear();
					for (pane of panes) {
						if (panetype(pane) == 'expr') {
							if (panetype(lastpane) == 'points') graph_expr(pane); else plot_text(pane);
						}
						if (panetype(pane) == 'points') plot_points(...pane);
						if (panetype(pane) == 'exprs') list_exprs(pane);
						if (panetype(pane) == 'pipeexpr') projection(...pane);
						var lastpane = pane;
					}
					function panetype(pane) {
						if (typeof pane == 'undefined') return 'null';
						if (typeof pane == 'string') return 'expr';
						if (pane.length == 3) return 'pipeexpr';
						if (Array.isArray(pane[0])) return 'points';
						return 'exprs';
					}
					function plot_clear() {
						$('#main').children().not(':first').remove();
					}
					function plot_text(text) {
						$('#main').append(`<td style="text-align:center;width:100px">${text}</td>`);
					}
					//function plot_html(index) {			//	-2022.06
					//	$('#main').append(`<td><div id="graph${index}" style="border:thin solid black; width:325px; height:325px"></div></td>`);
					//}
					function plot_html(index, title = '') {	//	+2022.06
						$('#main').append(`<td><div id="graph${index}" title="${title}" style="border:thin solid black; width:325px; height:325px"></div></td>`);
					}
					function list_exprs(exprs) {
						var title=['polyn1 a₀+a₁x+…+aₙxⁿ','laurent21 ax⁻²+bx⁻¹','laurent26 ax⁻²+bx⁻¹+c+dx+ex²+fx³+gx⁴+hx⁵+ix⁶','rational0_0 a/b','rational0_1 a/(bx)','rational1_0 (a+bx)/c','rational1_01H (a+bx)/(c+1*x)','sparse (a+bx+cx²)/(d+ex+fx²)','polynomialratio (a+bx+cx²)/(d+ex+fx²)'];
						var options = '';
						if (exprs.length>1) {
							options = [];
							for (let i = 0; i<exprs.length; i++)
								options.push(`<option value='${i}'' title='${title[i]}' onclick='vm.selected=${i}'>${exprs[i]}</option>`);
							options = options.join('');
							if (options) options = `<select size='9'>${options}</select>`;
						}
						$('#main').append(`<td width='160px'><details><summary>${exprs[vm.selected]}</summary>${options}</details></td>`);
					}
					//function plot_points(points, expr) {	//	-2022.06
					//	var id = math.round(math.random(999));
					//	plot_html(id);
					//	var vars = Expression.getvars(expr);
					//	if (points[0].length == 2)
					//		Plot.plot(points, 'graph' + id);
					//	else
					//		Plot.plot3(points, 'graph' + id, { xLabel: vars[0] || 'x', yLabel: vars[1] || 'y', width: '325px' , height: '325px' });
					//}
					function plot_points(points, expr) {	//	+2022.06
						var id = math.round(math.random(999));
						plot_html(id, points.map(point=>'('+math.format(point,1).slice(1,-1)+')').join('\n'));
						let plotable_points = points.map(point => math.typeof(point[0])=="Complex" ? plotable(point) : math.number(point));
						var vars = Expression.getvars(expr);
						if (plotable_points[0].length == 2)
							Plot.plot(plotable_points, 'graph' + id);
						else
							Plot.plot3(plotable_points, 'graph' + id, get_options());
						function plotable(point) {
							return [
								math.complex(point[0]).toPolar().phi,
								math.complex(point[1]).toPolar().phi,
								math.complex(point[1]).toPolar().r
							];
						}
						function get_options() {
							let dim = { width: '325px' , height: '325px' };
							if (math.typeof(points[0][0]) == "Complex") {
								let cameraPosition = { horizontal : 0, vertical : 1.57 };
								let bounds = { xMin : -3.14 , xMax : 3.14 , yMin : -3.14 , yMax : 3.14 };
								let labels = { xLabel: (vars[0] || 'x') + 'ᵩ', yLabel: 'yᵩ', zLabel: 'yᵣ' };
								return { ...dim , ...labels , ...bounds , cameraPosition , zStep: 1 };
							} else {
								return { ...dim , xLabel: vars[0] || 'x', yLabel: vars[1] || 'y' };
							}
						}
					}
					function graph_expr(expr) {
						if (expr === undefined) { var s = "index.plot3 Arg is undefined" ; alert(s) ; throw new Error(s) }
						var id = math.round(math.random(999));
						plot_html(id);
						var vars = Expression.getvars(expr);
						if (vars.length <= 1)
							Plot.graph(expr, 'graph' + id);
						else
							Plot.graph3(expr, 'graph' + id, { showLegend: true, legendLabel: '', style: 'surface', xLabel: vars[0] || 'x', yLabel: vars[1] || 'y', width: '325px' , height: '325px' });	//	+2023.02
							//Plot.graph3(expr, 'graph' + id, { style: 'surface', xLabel: vars[0] || 'x', yLabel: vars[1] || 'y', width: '325px' , height: '325px' });	//	-2023.02
					}
					function projection(expr, x, totalsimp) {
						var id = math.round(math.random(999));
						plot_text_html(expr + '|' + x, id);
						var vars = Expression.getvars(expr);
						if (vars.length <= 1)
							Plot.graph(expr, 'graph' + id).create('point', [x, totalsimp], { name: '', size: .1 });
						else
							Plot.graph3(totalsimp, 'graph' + id, { style: 'line', yMin: -5, yMax: 5, xLabel: vars[0], yLabel: vars[1], width: '325px' , height: '325px' });
						function plot_text_html(text, index) {
							$('#main').append(`<td><div style="text-align:center">${text}</div><div id="graph${index}" style="border:thin solid black; width:305px; height:305px"></div></td>`);
						}
					}
				}
			}
		</script>
	</head>
	<body>
		<center id='app'>
			<h1>Newton</h1>
			<table border="1">
				<tr id="main">
					<td>
						<center><button onclick="go()">Go</button></center><br>
						<input id='inp' placeholder="Type or Click Dropdown" style="position:absolute;width:140px;" value='0'>	<!--	2018.8	width for linux firefox -->
						<select onchange="$('#inp').val($(this).val())" style="height:23px;width:190px">	<!--	2018.6	width for linux firefox -->
							<option disabled>Choose a option or type</option>
							<optgroup label="0 Variable">
								<option selected>0</option>
								<option>1</option>
								<option>2</option>
								<option>12/8</option>
							</optgroup>
							<optgroup label="1 Variable">
								<option>x</option>
								<option>x*x</option>	<!--	+2021.5	-->
								<option>x/x</option>
								<option>(x^2-1)/(x-1)</option>
								<option>(x-1)/(x^2-1)</option>
								<option>2+h</option>
								<option>(2+h)^2</option>
								<option>(2+h)^2-2^2</option>
								<option>((2+h)^2-2^2)/h</option>
								<option>((2+h)^2-2^2)/h|0</option>
							</optgroup>
							<optgroup label="2 Variable">
								<option>x+h</option>
								<option>(x+h)^2</option>
								<option>(x+h)^2-x^2</option>
								<option>((x+h)^2-x^2)/h</option>
								<option>((x+h)^2-x^2)/h|0</option>
							</optgroup>
							<optgroup label="Exponential">
								<option>exp(x)</option>
								<option>exp(2x)</option>
								<option>sin(x)</option>
								<option>sin(3x)</option>
								<option>cos(x)</option>
								<option>cos(4x)</option>
								<option>sinh(x)</option>
								<option>sinh(5x)</option>
								<option>cosh(x)</option>
								<option>cosh(6x)</option>
							</optgroup>
						</select><br>
						<br>
						<details>	<!--	+2020.11	-->
							<summary>Advanced</summary>
							<input type='radio' value='0' id='ut' v-model='trans' onclick='vm.size=40'><label for='ut'>Untransformed</label><br>
							<input type='radio' value='1' id='dt' v-model='trans' @click='size=4'><label for='dt'>Differential Transform</label><br> <!--2018.11 Dif -->
							<div style='border: thin solid black'>
								<input type='range' min='1' max='9' step='1' v-model='range' title='Complexity'><span title='Complexity'>{{range}}</span><br>
								<br>
								<center v-if='e'>Complexity: {{range}}</center>				<!-- +2020.11 -->
								<center v-if='e'>Error: {{e[selected].toExponential(0)}}</center>				<!-- +2020.11 -->
							</div>
						</details>
						<br>
						<center v-if='e'>																				<!--	+2020.11	-->
							<!--<span v-if='e[selected]>.0001' style='color:red'>Simplification isn't valid</span>-->	<!--	-2020.12	-->
							<span v-if='e[selected]>.0002' style='color:red'>Simplification isn't valid</span>			<!--	+2020.12	-->
							<span v-else-if='e[selected]<.00001' style='color:green'>Simplification is valid</span>
							<span v-else style='color:orange'>Simplification maybe valid</span>
						</center>
					</td>
				</tr>
			</table>
		</center>
		<script>
			vm = new Vue({
				el: '#app',
				//data: { trans: 0, size: 40, range: 1, expr: '', exprsimp: [], selected: '0', e: '' },										//	+2020.11	//	-2022.06
				data: { trans: 0, size: 40, range: 1, expr: '', exprsimp: [], selected: 0, e: '' },											//	+2020.11	//	+2022.06
				watch: { exprsimp: render, selected: render }	//	2019.5	Added
			});
		</script>
	</body>
</html>
